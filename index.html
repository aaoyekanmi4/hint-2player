<!doctype html>
  <html>

    <head>
      <meta charset="UTF-8" />
      <title>Choose a character</title>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/swanky-purse/jquery-ui.min.css" rel="stylesheet">
       <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/swanky-purse/theme.min.css" rel="stylesheet">
    </head>

    <body>

      <section>


<div id="shared-space">
 <div style="width: 1100px; display: none;" id="notebook">
    <canvas id="myCanvas" height= 600 width=400></canvas>
    <div class="notes" style="float:right;">
    <div style="width: 100px; height: 50px; font-size: 45px;">Notes</div>
    <textarea style="; width: 550px; height: 540px; border-width: 4px; border-color: black; "></textarea>
    </div>


    </div>
<canvas id="canvas" width="1100" height="600">
This text is displayed if your browser does not support HTML5 Canvas.
</canvas>


<div style="float: right; width:210px; height: 600px;" id="make-moves">
<button id="rollDye" style="font-size:25px" class="ui-button ui-widget ui-corner-all">Roll Dice <img style="width:30px; height: 30px; background-color:transparent;" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/2-Dice-Icon.svg/2000px-2-Dice-Icon.svg.png"/></button>
<div class="ui-widget-header" id="waiting-message" style="padding: 0; font-size:30px">It is your opponent's turn</div>
  <div class="showRoll ui-widget-content" style="font-size:25px" >Dice Roll: <span id="rolled-number"></span></div>
  <div class="showMoves ui-widget-content" style="font-size:25px"> Moves Left: <span id="moves-left"></span></div>


  <ul id="player-cards" class="ui-widget-header" style="list-style-type: none; padding: 0; font-size:30px"> Cards</ul>

        <button id="view-notebook" class="ui-button ui-widget ui-corner-all">Notebook <i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
  </div>


</div>

        <div id="dialog-form" title="Pick a character">
          <form>
            <div id="waiting">Waiting for player 2</div>
            <div class="widget characters">
              <button class="ui-button ui-widget ui-corner-all" id="Plum">Prof. Plum  <i class="fa fa-circle-o" style="color:purple;" aria-hidden="true"></i></button>

              <button class="ui-button ui-widget ui-corner-all" id="Mustard">Col. Mustard  <i class="fa fa-circle-o" style="color:yellow;" aria-hidden="true"></i></button>
              <button class="ui-button ui-widget ui-corner-all" id="Black" >Mrs. Black  <i class="fa fa-circle-o" style="color:black;" aria-hidden="true"></i></button>
              <br>
              <br>
              <br>
              <button class="ui-button ui-widget ui-corner-all" id="Green">Mr. Green  <i class="fa fa-circle-o" style="color:green;" aria-hidden="true"></i></button>
              <button class="ui-button ui-widget ui-corner-all" id="Peacock">Mrs.Peacock  <i class="fa fa-circle-o" style="color:blue" aria-hidden="true"></i></button>
              <button class="ui-button ui-widget ui-corner-all" id="Scarlet">Ms. Scarlet  <i class="fa fa-circle-o" style="color:red;" aria-hidden="true"></i></button>
            </div>

            <div id ="already-picked"></div>
            <div id="opponents-choice"></div>

          </form>
        </div>
        <div id="suggestion-form" title="Make Suggestion">


  <form>

      <label for="suspect">Suspect</label>
      <select class="ui-selectmenu" name="suspect" id="suspects">
        <option class="suspect" value="Mrs. Peacock">Mrs. Peacock</option>
        <option class="suspect" value="Col. Mustard">Col. Mustard</option>
        <option class="suspect" value="Prof. Plum">Prof. Plum</option>
        <option class ="suspect" value ="Mr. Green">Mr. Green</option>
        <option class ="suspect" value ="Mrs. White">Mrs. White</option>
        <option class ="suspect" value ="Ms. Scarlet">Ms. Scarlet</option>


      </select>
      <label for="weapon">Weapon</label>
      <select  name="weapon" id="weapons">
        <option class="weapon" value="Knife"> Knife</option>
        <option class="weapon" value="Candlestick">Candlestick</option>
        <option class="weapon" value="Wrench">Wrench</option>
        <option class="weapon" value="Revolver">Revolver</option>
        <option class="weapon" value="Leadpipe">Lead Pipe</option>
        <option class="weapon" value="Rope">Rope</option>
      </select>
      <label for="place">Room</label>
      <span tabindex="0" id="name-of-room" role="combobox" aria-expanded="false"  class="ui-selectmenu-button ui-button ui-widget ui-selectmenu-button-closed ui-corner-all" aria-activedescendant="ui-id-8" aria-labelledby="ui-id-8" aria-disabled="true"><span class="ui-selectmenu-text"></span></span>

  </form>
</div>
      </section>
      <script src="/socket.io/socket.io.js"></script>
      <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
      <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
      <script src="https://use.fontawesome.com/6791ba42d9.js"></script>
      <script>

       function matrix( rows, cols, defaultValue){

  var grid = [];

  // Creates all lines:
  for(var i=0; i < rows; i++){

      // Creates an empty line
      grid.push([]);

//j set to 5 to blank out row labels
      for(var j=6; j < cols; j++){
        // Initializes:
        grid[i][j] = defaultValue;
      }
  }

return grid;
}

function fill(s, row, column) {
        context.fillStyle = s;
        var innerSize = size-2;
        context.fillRect(((row * size) + 1), ((column * size) + 1), innerSize, innerSize);
    }

var grid = matrix(24, 14, 0);
;

      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');
      var gridWidth = 350;
      var gridHeight = 600;
      var movingPlayer


      context.beginPath();
      context.lineWidth = 4;
      var offset = 0;
      context.rect(offset, offset, gridWidth, gridHeight);


      context.strokeStyle = 'black';
      context.stroke();
      var startingPoint = (gridHeight + offset) - 25;
      var size = 25;


 //      Draw lines horizontally
      for (var i =0; i < 25; i++) {
        context.beginPath();
        context.lineWidth = 1;
        context.moveTo(offset, startingPoint);
        context.lineTo(offset + gridWidth, startingPoint);
        context.stroke();
        startingPoint = startingPoint - size;
      }
     var startingPoint = (gridWidth + offset) - 25;
      //Draw lines vertically
      for (var i =0; i < 8; i++) {
        context.beginPath();
        context.lineWidth = 1;
        context.moveTo(startingPoint, 0);
        context.lineTo(startingPoint, 600);
        context.stroke();
        startingPoint = startingPoint - size
      }
//add weapons
      var weapons = ["knife", "candlestick", "wrench", "revolver", "lead pipe", "rope" ]

var startingPoint = gridHeight + offset;
for (var i = 0; i < weapons.length; i ++) {
  context.font = "15px Arial";
  context.fillStyle = "black";
 context.textAlign = "left";
  context.fillText(weapons[i], offset+ 5, startingPoint -5);
  startingPoint = startingPoint - size;
 }

 context.fillStyle = "black";
 context.fillRect(0, 425, 350, 25)
 context.font = "20px san-serif";
 context.fillStyle= "white";
 context.fillText("Weapons", offset, startingPoint -5);
//add suspects
var suspects = ["Col. Mustard", "Prof. Plum", "Ms. Scarlet", "Mr. Green", "Mrs. Peacock", "Mrs. White"]
var startingPoint = 425 + offset;
for (var i = 0; i < suspects.length; i ++) {
  context.font = "15px Arial";
  context.fillStyle = "black";
 context.textAlign = "left";
  context.fillText(suspects[i], offset+ 5, startingPoint -5);
  startingPoint = startingPoint - size;
 }

 context.fillStyle = "black";
 context.fillRect(0, 250, 350, 25)
 context.font = "20px san-serif";
 context.fillStyle= "white";
 context.fillText("Suspects", offset, startingPoint -5);

 //add locations

       var locations = ["hall", "study", "dining room", "ballroom", "billiard", "conservatory", "lounge", "kitchen", "library"]

var startingPoint = 250 + offset;
for (var i = 0; i < locations.length; i ++) {
  context.font = "15px Arial";
  context.fillStyle = "black";
 context.textAlign = "left";
  context.fillText(locations[i], offset+ 5, startingPoint -5);
  startingPoint = startingPoint - size;
 }

 context.fillStyle = "black";
 context.fillRect(0, 0, 350, 25)
 context.font = "20px san-serif";
 context.fillStyle= "white";
 context.fillText("Locations", offset, startingPoint -5);


      function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }

      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');

      canvas.addEventListener('click', function(evt) {
        var mousePos = getMousePos(canvas, evt);
        var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;

        var column = Math.floor(mousePos.x/size);
        var row = Math.floor(mousePos.y/size);
        console.log(column + "," + row);
        console.log(column * size)
        console.log(row * size)
        if (grid[row][column] === 0) {
            fill('black', column, row)
            grid[row][column]=1
        }
         else if(grid[row][column] === 1){
fill('white', column, row)
grid[row][column] =0
        }
      });

        $( function() {


          var canvas;
          var context;
          var size = 25;
          var dx = 25;
          var dy = 25;
          var r = 10;
          var x = 537.5;
          var y = 312.5;
          var WIDTH = 1100;
          var HEIGHT = 600;

          var rollAmount;
          var movesLeft;
          var i;
          var beforeRoom;


          var playerCards = [];
          var player2Cards = [];

          function circle(x,y,r, color) {
          context.beginPath();
          context.fillStyle = color;
          context.arc(x, y, r, 0, Math.PI*2, true);
          context.fill();
          }

          function rect(x,y,w,h) {
          context.beginPath();
          context.rect(x,y,w,h);
          context.closePath();
          context.fill();
          context.stroke();
          }

          function drawGrid (HEIGHT, WIDTH, size) {
           //      Draw lines horizontally
           var startingPoint = HEIGHT - size;
                for (var i =0; i < (HEIGHT/size -1); i++) {
                  context.beginPath();
                  context.lineWidth = 1;
                  context.moveTo(0, startingPoint);
                  context.lineTo(WIDTH, startingPoint);
                  context.stroke();
                  startingPoint = startingPoint - size;
                }
               var startingPoint = WIDTH - size;
                //Draw lines vertically
                for (var i =0; i < (WIDTH/size  -1); i++) {
                  context.beginPath();
                  context.lineWidth = 1;
                  context.moveTo(startingPoint, 0);
                  context.lineTo(startingPoint, HEIGHT);
                  context.stroke();
                  startingPoint = startingPoint - size
                }

          }


          //Draw rooms

          function drawRoom(roomName){
            context.beginPath();

                 context.lineWidth = 4;

                  context.rect(roomName.x, roomName.y, roomName.width, roomName.height);
                  context.stroke();
                  context.fillStyle = 'rgba(225,225,225,0.5)';
                  context.fillRect(roomName.x + 2, roomName.y + 2, roomName.width - 4, roomName.height - 4);
                   context.font = "20px san-serif";
                  context.fillStyle ="black";
                  context.fillText(roomName.name, (roomName.x + (roomName.width/2)-25), (roomName.height+roomName.y) - (roomName.height/2));
          }


          function clear() {
          context.clearRect(0, 0, WIDTH, HEIGHT);
          }

          function draw() {
          clear();
          context.fillStyle = "white";
          context.strokeStyle = "black";
          rect(0,0,WIDTH,HEIGHT);

          circle(player.x, player.y, r, player.color);
          circle(opponent.x, opponent.y, r, opponent.color);

          drawGrid(HEIGHT, WIDTH, size);
          placesArray.forEach(drawRoom);

          }

          function init() {
          canvas = document.getElementById("canvas");
          context = canvas.getContext("2d");
          $("#make-moves").show();
              return setInterval(draw, 10);
          }


          //calls io from index.js
          var socket = io();

          //object containing player and player2
          var player = {
                        character:"",
                        id:"",
                        isTurn:false,
                        inRoom:false,
                        cards: [],
                        trackedTurn : [],
                        x:"",
                        y: "",
                        color: ""
                        }

            var opponent = {
                        character:"",
                        id:"",
                        isTurn:false,
                        inRoom:false,
                        trackedTurn : [],
                        x:"",
                        y: "",
                        color: ""
                        }





          function getColor (player) {
            if (player.character === "Col. Mustard  "){
                  player.color = "yellow";
                }
                 else if (player.character === "Mrs.Peacock  "){
                  player.color = "blue";
                } else if (player.character === "Mr. Green  "){
                  player.color= "green";
                } else if (player.character === "Prof. Plum  "){
                  player.color = "purple";
                } else if (player.character === "Mrs. Black  "){
                  player.color = "black";
                } else if (player.character === "Ms. Scarlet  "){
                  player.color = "red";
                }
          }

          var library = {name: "Library", x:0,y:0,width:300,height:150};

          var study = {name:"Study", x:350,y:0,width:250,height:150};
          var hall= {name:"Hall", x:700,y:0,width:125,height:200};
          var lounge = {name:"Lounge", x:875,y:0,width:225,height:175};
          var diningRoom = {name:"Dining Room", x:875,y:250,width:225,height:125};
          var kitchen = {name: "Kitchen", x:625,y:450,width:250,height:150};
          var ballroom = {name:"Ballroom", x:275,y:375,width:225,height:225};
          var conservatory = {name: "Conservatory", x:0,y:300,width:225,height:225};
          var billiard = {name: "Billiard Room", x:925,y:425,width:175,height:175};

          var placesArray =[library, study, hall, lounge, diningRoom, kitchen, ballroom, conservatory, billiard];

          var places = [];

          placesArray.forEach( function(place) {
            places.push(place.name);
          });

          var weapons = ["Knife", "Candlestick", "Wrench", "Revolver", "Lead pipe", "Rope" ];

          var suspects = ["Col. Mustard", "Prof. Plum", "Ms. Scarlet", "Mr. Green", "Mrs. Peacock", "Mrs. Black"];

          //Fisher Yates shuffle
          function shuffle (array) {
            var i = 0
              , j = 0
              , temp = null

            for (i = array.length - 1; i > 0; i -= 1) {
              j = Math.floor(Math.random() * (i + 1))
              temp = array[i]
              array[i] = array[j]
              array[j] = temp
            }
          }


          function dealCards (array) {
            for (var i = 0; i < array.length; i++) {

              playerCards.push(array[i]);
              i += 1
              player2Cards.push(array[i]);
            }


          }


socket.on('showMovesLeft', function(movesLeft, rollAmount) {
  if (typeof movesLeft !== 'undefined'){
    $("#rolled-number").text(rollAmount);
    $("#moves-left").text(movesLeft)
  }
});







function rollDye () {
    rollAmount = Math.floor((Math.random() * 12) + 1);



  $("#rollDye").hide();
  $(".showRoll").show();
  $(".showMoves").show();

    i =0;
    movesLeft = rollAmount;
    socket.emit('trackRoll', movesLeft, rollAmount)
    console.log(rollAmount.toString());

    // if (movesLeft === 0) {
    //   players[0].isTurn = false;
    // }
    return rollAmount


}

$("#view-notebook").click(function(){
  $("#notebook").slideToggle( "slow" );


  });

function changeTurn(movesLeft, player){
  if (movesLeft === 0){
    socket.emit('changeTurn');
  }
}


function doKeyDown(evt){
 if (player.isTurn === true) {






if (typeof rollAmount !== 'undefined') {

if (i === rollAmount || movesLeft === 0){

return }

switch (evt.keyCode) {
case 38:  /* Up arrow was pressed */

if (player.y - dy > 0){
player.y -= dy;
i += 1


console.log(player.y);
movesLeft = rollAmount - i;

socket.emit('trackRoll', movesLeft, rollAmount)
player.trackedTurn.push({x:  + player.x, y: + player.y });
console.log(player.trackedTurn);
changeTurn(movesLeft, player)
 }





break;
case 40:  /* Down arrow was pressed */

if (player.y + dy < HEIGHT){
player.y += dy;
i += 1



movesLeft = rollAmount - i;
socket.emit('trackRoll', movesLeft, rollAmount)
player.trackedTurn.push({x:  + player.x, y: + player.y });
console.log(player.trackedTurn);

changeTurn(movesLeft, player)



}

break;
case 37:  /* Left arrow was pressed */
if (player.x - dx > 0){
player.x -= dx;
i += 1
movesLeft = rollAmount - i;
socket.emit('trackRoll', movesLeft, rollAmount)
player.trackedTurn.push({x:  + player.x, y: + player.y });
console.log(player.trackedTurn);
changeTurn(movesLeft, player)
}
break;
case 39:  /* Right arrow was pressed */
if (player.x + dx < WIDTH){
player.x += dx;
i +=1
movesLeft = rollAmount - i;
socket.emit('trackRoll', movesLeft, rollAmount)
player.trackedTurn.push({x:  + player.x, y: + player.y });

console.log(player.trackedTurn);
changeTurn(movesLeft, player)
}
break;
}


socket.emit('playerMoved', player.x, player.y)
}
}
}



  //remove button from avaiable options
              function removeCharacter(msg){
              var buttonPressed = $("button:contains('" + msg + "')")
              var buttonId = (buttonPressed.attr('id'))
              $("#" + buttonId).remove();
            }









document.getElementById("rollDye").addEventListener("click", rollDye);
window.addEventListener('keyup',doKeyDown,true);
window.addEventListener('keyup',socket.on('playerMoved', function(x, y, id){
    if (player.id === id){
      console.log("foo")
       console.log(x);
    console.log(y);
        player.y = y;
  player.x = x;
}
  else{
    console.log("bar")
    console.log(x);
    console.log(y);
    opponent.y = y;
    opponent.x =x;
     circle(opponent.x, opponent.y, r, opponent.color);
  }




}));

window.addEventListener('keyup', function checkCollision(){
  for (var i = 0; i < placesArray.length; i++) {
    if (placesArray[i].name !== "Start") {

var playerWidth = (player.x - 12.5) + (2 * r);
var playerHeight = (player.y - 12.5) + (2 * r);

  if (placesArray[i].x < playerWidth  && placesArray[i].x + placesArray[i].width  > player.x &&
    placesArray[i].y < playerHeight && placesArray[i].y + placesArray[i].height > player.y) {

console.log("we are in the " + placesArray[i].name + " area");
$("#name-of-room").text(placesArray[i].name);

beforeRoom = player.trackedTurn[player.trackedTurn.length - 2];
console.log(beforeRoom);

movesLeft = 0;

          console.log(player.trackedTurn);
suggestionDialog.dialog( "open" );
}
}
}
});

          var suggestionDialog;
          var dialog;
          var form;
           //jquery ui dialog for options box
          dialog = $( "#dialog-form" ).dialog({
            autoOpen: false,
            height: 400,
            width: 650,
            modal: true,

            close: function() {
              form[ 0 ].reset();
            }
          });

            suggestionDialog = $( "#suggestion-form" ).dialog({
      autoOpen: false,
      height: 400,
      width: 350,
      modal: true,
      buttons: {
        Submit: function() {
          var hitSuggestion = [];
          var suspect = $("#suspects").val();
          var weapon = $("#weapons").val();
          var place = $("#name-of-room").text();

          console.log(player2Cards.indexOf(suspect));
          console.log(player2Cards.indexOf(weapon));
          console.log(player2Cards.indexOf(place));

          if (player2Cards.indexOf(suspect) > -1) {
            hitSuggestion.push(suspect);

          }
           if (player2Cards.indexOf(weapon) > -1) {
            hitSuggestion.push(weapon);

          }
           if (player2Cards.indexOf(place) > -1) {
            hitSuggestion.push(place);

          }
          shuffle(hitSuggestion);
          var shownCard = hitSuggestion.pop();

          alert(shownCard);
          player.x = beforeRoom.x
          player.y = beforeRoom.y
         players[0].trackedTurn.push(beforeRoom);
         changeTurn(movesLeft, player);
           dialog.dialog( "close" );


        },

      },

    });

    form = dialog.find( "form" ).on( "submit", function( event ) {
      event.preventDefault();

    });

       $( "#suspects" ).selectmenu();

    $( "#weapons" ).selectmenu();

    $("#room").selectmenu();
          form = dialog.find( "form" ).on( "submit", function( event ) {
              event.preventDefault();
          });


          $( "button, input, a" ).click( function( event ) {
            event.preventDefault();
            }
          );

          //create jquery ui buttons
          $( ".widget input[type=submit], .widget a, .widget button" ).button();

          //show waiting message if only one user connected
          $("#waiting").show();
          $(".characters").hide();
          $("#make-moves").hide();
          //open dialog with options to pick characters
              dialog.dialog( "open" );





          //on click of button in a browser windo send button's text to server
          $("button").click( function(){

            socket.emit('nameChosen', $(this).text());
          });




          //get socket ids from index.js and add them to players object


          socket.on('grabSocketId', function(id, cards, x, y){


          player.id = id;
          player.cards = cards;
          player.x = x;
          player.y = y;

             $.each(player.cards, function (index, value) {
    $('#player-cards').append($('<li/>', {
        value: value,
        text : value,
        class: "ui-widget-content"
    }))
})

              //hide waiting since there are now 2 players
              $("#waiting").hide();
              $(".characters").show();


console.log(player);
});







          //function for if user already picked a name and clicked a button
          socket.on('selectCharacter', function(msg, id){

              $("#already-picked").append("You've picked " + msg);
                  player.character = msg;
                  getColor(player)



              console.log(player);
              removeCharacter(msg)
              socket.emit('opponentInfo', player.id, player.x, player.y, player.color, player.character);
              socket.emit('startGame', msg)




          });



           socket.on('opponentPicked', function(msg, id){


                if (player.id !== id){
                  $("#opponents-choice").append("Your opponent picked " + msg);
                }


                removeCharacter(msg)

              });
           socket.on('opponentInfo', function( id, x, y, color, character){
            opponent.id = id;
            opponent.x = x;
            opponent.y = y;
            opponent.color = color;
            opponent.character = character;
            console.log(opponent);


           });


socket.on('startTurn', function(turnValue){
  player.isTurn = turnValue;
  $("#rollDye").show();
  $(".showRoll").hide();
  $(".showMoves").hide();
  $("#waiting-message").hide();

})

socket.on('notTurn', function(turnValue){
  player.isTurn = turnValue;
    $("#rollDye").hide();
  $(".showRoll").show();
  $(".showMoves").show();
  $("#waiting-message").show();
  $("#rolled-number").text('');
    $("#moves-left").text('');
})

socket.on('startGame', function(){
  init()
});



             });


    </script>

    </body>
  </html>